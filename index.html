<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VC & Corporate Fund Explorer — Life Sciences</title>
  <!-- Mukta font for the fit button -->
  <link href="https://fonts.googleapis.com/css?family=Mukta:700" rel="stylesheet">
  <style>
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    :root {
      --primary-dark: #013220;
      --primary-main: #008060;
      --primary-light: #e6f2ef;
      --bg-main: #f7faf9;
      --bg-card: #ffffff;
      --border-color: #dce5e2;
      --shadow-color: rgba(1, 50, 32, 0.1);
      --muted-text: #5a7067;
    }

    body {
      background-color: var(--bg-main);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      color: var(--primary-dark);
      margin: 0;
      padding: 2rem;
      line-height: 1.6;
    }

    .app { max-width: 1400px; margin: 0 auto; }

    header {
      display: flex; align-items: center;
      margin-bottom: 2rem; padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }
    header img {
      height: 72px; width: auto; margin-right: 1.5rem;
      border-radius: 10px; box-shadow: 0 4px 12px var(--shadow-color);
      background: #fff;
    }
    header h1 { font-size: 2rem; margin: 0 0 0.25rem 0; color: var(--primary-dark); font-weight: 600; }
    header .lead { font-size: 1.1rem; color: var(--muted-text); margin: 0; }

    .controls {
      display: flex; flex-wrap: wrap; gap: 1rem; align-items: center;
      margin-bottom: 1.5rem; background: var(--bg-card);
      padding: 1.5rem; border-radius: 12px;
      box-shadow: 0 4px 12px var(--shadow-color);
    }

    .searchbox {
      display: flex; align-items: center; flex-grow: 1;
      background: #fff; border: 1px solid var(--border-color);
      border-radius: 8px; padding: 0 0.5rem 0 1rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .searchbox:focus-within { border-color: var(--primary-main); box-shadow: 0 0 0 3px rgba(0,128,96,0.2); }
    .searchbox svg { stroke: #9aa4b2; }
    .searchbox input {
      border: none; outline: none; width: 100%;
      padding: 0.75rem 0.5rem; font-size: 1rem; background: transparent;
    }

    .filters { display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; }

    /* Multi-select filter styles */
    .multi-filter {
      position: relative;
      min-width: 180px;
      max-width: 320px;
      font-size: 0.95rem;
    }
    .multi-filter .summary {
      width: 100%;
      text-align: left;
      padding: 0.65rem 0.9rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: #fff;
      color: var(--primary-dark);
      cursor: pointer;
    }
    .multi-filter .summary:focus { outline: none; box-shadow: 0 0 0 3px rgba(0,128,96,0.12); }
    .multi-filter .options {
      display: none;
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      z-index: 40;
      max-height: 220px;
      overflow: auto;
      padding: 0.5rem;
    }
    .multi-filter.open .options { display: block; }
    .multi-filter .options label {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.35rem 0.5rem; border-radius: 6px; cursor: pointer;
    }
    .multi-filter .options label:hover { background: #f4fbf8; }
    .multi-filter .options input[type="checkbox"] { width: 16px; height: 16px; }

    .select { /* keep class for backwards compatibility but hide native select if present */ display: none; }

    .btn {
      padding: 0.75rem 1.25rem; font-size: 1rem; border-radius: 8px;
      border: 1px solid transparent; cursor: pointer;
      font-weight: 500; transition: all 0.2s ease;
    }

    #clear, #reset {
      background-color: #f8f9fa; color: var(--muted-text); border-color: var(--border-color);
    }
    #clear:hover, #reset:hover { background-color: #e9ecef; border-color: #a3b5af; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem; margin-top: 1rem;
    }

    /* Card structure */
    .card, .card-inner, .card-front, .card-back { box-sizing: border-box; }
    .card {
      min-height: 340px; position: relative;
      background: var(--bg-card); border-radius: 12px;
      border: 3px solid var(--border-color);
      box-shadow: 0 4px 12px var(--shadow-color);
      animation: fadeIn 0.5s ease-out forwards;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      perspective: 1000px;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 24px var(--shadow-color); }

    .card-inner { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.8s ease; }
    .card:hover .card-inner { transform: rotateY(180deg); }

    .card-front, .card-back {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      backface-visibility: hidden; border-radius: 12px;
      background: var(--bg-card); padding: 1.5rem; display: flex; flex-direction: column;
    }

    .card-back {
      transform: rotateY(180deg);
      justify-content: space-between;
      align-items: center;
      text-align: center;
      color: var(--primary-dark);
      background: var(--primary-light);
      padding: 1.5rem;
    }

    .card img {
      width: 56px; height: 56px; object-fit: contain;
      margin-bottom: 1rem; border-radius: 8px; background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .card h3 {
      font-size: 1.25rem; font-weight: 600;
      color: var(--primary-dark); margin: 0 0 0.5rem 0;
      position: relative; padding-bottom: 0.25rem;
    }

    /* Base underline */
    .card h3::after {
      content: ""; position: absolute; left: 0; bottom: 0;
      width: 100%; height: 3px; border-radius: 2px;
      background-color: transparent; transition: background-color 0.3s ease;
    }

    /* Fit-color border mapping */
    .fit-excellent { border-color: #2e7d32; }
    .fit-high { border-color: #4caf50; }
    .fit-good { border-color: #8bc34a; }
    .fit-moderate { border-color: #ffc107; }
    .fit-potential { border-color: #ff9800; }
    .fit-low { border-color: #f44336; }
    .fit-neutral { border-color: #9e9e9e; }
    .fit-none { border-color: var(--border-color); }

    /* Fit-color underline mapping */
    .fit-excellent .card-front h3::after { background-color: #007e33; }
    .fit-high .card-front h3::after { background-color: #2e7d32; }
    .fit-good .card-front h3::after { background-color: #43a047; }
    .fit-moderate .card-front h3::after { background-color: #ff8f00; }
    .fit-potential .card-front h3::after { background-color: #ffb300; }
    .fit-low .card-front h3::after { background-color: #c62828; }
    .fit-neutral .card-front h3::after { background-color: #9e9e9e; }

    .card .meta { font-size: 1rem; margin-bottom: 1rem; color: var(--muted-text); }
    .card .tags { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; }
    .card .tag {
      padding: 0.4rem 0.8rem; font-size: 0.9rem;
      background: var(--primary-light); color: var(--primary-main);
      border-radius: 999px; display: inline-block;
      transition: all 0.2s ease; cursor: pointer;
      border: 1px solid rgba(0,128,96,0.1);
    }
    .card .tag:hover { background: var(--primary-main); color: #fff; transform: scale(1.05); }

    .fit-indicator {
      font-weight: bold; margin-bottom: 1rem; padding: 0.5rem;
      border-radius: 6px; background: var(--primary-light); color: var(--primary-main);
    }

    .fit-high { background: #e8f5e9; color: #2e7d32; }
    .fit-medium { background: #fff8e1; color: #ff8f00; }
    .fit-low { background: #ffebee; color: #c62828; }
    .fit-none { background: #f5f5f5; color: #616161; }

    footer {
      text-align: center; padding: 2rem 0; margin-top: 2rem;
      color: var(--muted-text); border-top: 1px solid var(--border-color);
    }

    /* Disclaimer styling */
    .disclaimer {
      margin-top: 2rem; padding: 1.5rem 2rem;
      background: var(--primary-light);
      border-radius: 12px; border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px var(--shadow-color);
      color: var(--primary-dark);
    }
    .disclaimer h2 {
      margin-top: 0; color: var(--primary-main); font-size: 1.3rem;
    }
    .disclaimer p { margin-bottom: 0.75rem; color: var(--primary-dark); }

    .disclaimer .fit-label { font-weight: bold; }
    .disclaimer .fit-excellent { color: #007e33; }
    .disclaimer .fit-high { color: #2e7d32; }
    .disclaimer .fit-good { color: #43a047; }
    .disclaimer .fit-potential { color: #ffb300; }
    .disclaimer .fit-moderate { color: #ff8f00; }
    .disclaimer .fit-low { color: #c62828; }
    .disclaimer .fit-neutral { color: #9e9e9e; }

    /* Modal styles */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1000; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
      animation: fadeIn 0.3s ease-out;
    }

    .modal-content {
      background-color: #fefefe;
      margin: 8% auto; /* 8% from the top and centered */
      padding: 2rem;
      border: 1px solid var(--border-color);
      width: 80%;
      max-width: 720px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      position: relative;
      animation: slideIn 0.4s ease-out;
    }

    .modal-close {
      color: #aaa;
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .modal-close:hover,
    .modal-close:focus {
      color: #333;
      text-decoration: none;
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @media (max-width: 768px) {
      body { padding: 1rem; }
      header { flex-direction: column; text-align: center; align-items: flex-start; }
      header img { margin-right: 0; margin-bottom: 1rem; }
      .controls { flex-direction: column; align-items: stretch; }
      .searchbox { width: 100%; }
      .filters { justify-content: center; }
      .grid { grid-template-columns: 1fr; }
      .multi-filter { width: 100%; max-width: none; }
    }

    /* ... existing styles */
    .card .link:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .blob-btn {
      z-index: 1;
      position: relative;
      padding: 0.5rem 1.5rem;
      margin-top: auto;
      text-align: center;
      text-transform: uppercase;
      color: var(--primary-main);
      font-size: 0.85rem;
      font-weight: bold;
      background-color: transparent;
      outline: none;
      border: none;
      transition: color 0.5s;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      align-self: center;
    }

    .blob-btn:before {
      content: "";
      z-index: 1;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      border: 2px solid var(--primary-main);
      border-radius: 30px;
    }

    .blob-btn:after {
      content: "";
      z-index: -2;
      position: absolute;
      left: 3px;
      top: 3px;
      width: 100%;
      height: 100%;
      transition: all 0.3s 0.2s;
      border-radius: 30px;
    }

    .blob-btn:hover {
      color: #FFFFFF;
      border-radius: 30px;
    }

    .blob-btn:hover:after {
      transition: all 0.3s;
      left: 0;
      top: 0;
      border-radius: 30px;
    }

    .blob-btn__inner {
      z-index: -1;
      overflow: hidden;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      border-radius: 30px;
      background: #ffffff;
    }

    .blob-btn__blobs {
      position: relative;
      display: block;
      height: 100%;
      filter: url('#goo');
    }

    .blob-btn__blob {
      position: absolute;
      top: 2px;
      width: 25%;
      height: 100%;
      background: var(--primary-main);
      border-radius: 100%;
      transform: translate3d(0, 150%, 0) scale(1.7);
      transition: transform 0.45s;
    }
    
    .blob-btn:hover .blob-btn__blob {
        transform: translateZ(0) scale(1.7);
    }

    .blob-btn__blob:nth-child(1) {
      left: 0%;
      transition-delay: 0s;
    }

    .blob-btn__blob:nth-child(2) {
      left: 30%;
      transition-delay: 0.08s;
    }

    .blob-btn__blob:nth-child(3) {
      left: 60%;
      transition-delay: 0.16s;
    }

    .blob-btn__blob:nth-child(4) {
      left: 90%;
      transition-delay: 0.24s;
    }

    .card img {
/* ... existing styles */
    /* Fit-button styles (converted from provided SCSS) */
    .fit-btn {
      font-family: 'Mukta', sans-serif;
      position: relative;
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      outline: none;
      border: 0;
      background: transparent;
      padding: 0;
      width: 12rem;
      height: auto;
      text-transform: uppercase;
      font-weight: 700;
      -webkit-font-smoothing: antialiased;
      transition: all 0.45s cubic-bezier(0.65,0,.076,1);
    }
    .fit-btn .circle {
      transition: all 0.45s cubic-bezier(0.65,0,.076,1);
      display: block;
      width: 3rem;
      height: 3rem;
      background: #282936;
      border-radius: 1.625rem;
      position: relative;
      flex: 0 0 auto;
      margin-left: 0.25rem;
      margin-right: 0.6rem;
    }
    .fit-btn .icon {
      transition: all 0.45s cubic-bezier(0.65,0,.076,1);
      position: absolute;
      top: 50%;
      left: 0.65rem;
      transform: translateY(-50%);
      width: 1.125rem;
      height: 0.125rem;
      background: none;
    }
    .fit-btn .icon.arrow::before {
      content: '';
      position: absolute;
      top: -0.25rem;
      right: 0.0625rem;
      width: 0.625rem;
      height: 0.625rem;
      border-top: 0.125rem solid #fff;
      border-right: 0.125rem solid #fff;
      transform: rotate(45deg);
    }
    .fit-btn .button-text {
      transition: all 0.45s cubic-bezier(0.65,0,.076,1);
      padding: 0.75rem 0;
      margin-left: 0;
      color: #282936;
      line-height: 1.6;
      text-align: center;
      width: 100%;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .fit-btn:hover .circle {
      width: 100%;
    }
    .fit-btn:hover .circle .icon.arrow {
      background: #fff;
      transform: translateX(1rem) translateY(-50%);
    }
    .fit-btn:hover .button-text {
      color: #ffffff;
    }
    /* ensure the existing fit-indicator visuals remain compatible */
    .fit-indicator { padding: 0; background: transparent; color: inherit; font-weight: 700; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <img src="IBEC.png" alt="IBEC Logo">
      <div>
        <h1>VC & Corporate Fund Explorer — Life Sciences</h1>
        <p class="lead">Search, filter and browse the list visually. Click a logo/website to open the fund page.</p>
      </div>
    </header>

    <div class="controls">
      <div class="searchbox" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#9aa4b2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="#9aa4b2" stroke-width="1.5"></circle></svg>
        <input id="q" placeholder="Search name, stage, location, focus..." autocomplete="off" />
        <button class="btn" id="clear">Clear</button>
      </div>
      <div class="filters">
        <!-- replaced select elements with checkbox multi-filters -->
        <div class="multi-filter" id="typeFilter" data-key="Type">
          <button class="summary" type="button">All types</button>
          <div class="options" role="listbox" aria-multiselectable="true"></div>
        </div>

        <div class="multi-filter" id="stageFilter" data-key="Investment Stage">
          <button class="summary" type="button">All stages</button>
          <div class="options" role="listbox" aria-multiselectable="true"></div>
        </div>

        <div class="multi-filter" id="regionFilter" data-key="Where They Invest">
          <button class="summary" type="button">All regions</button>
          <div class="options" role="listbox" aria-multiselectable="true"></div>
        </div>

        <div class="multi-filter" id="fitFilter" data-key="Drug4Sight Fit">
          <button class="summary" type="button">All fits</button>
          <div class="options" role="listbox" aria-multiselectable="true"></div>
        </div>

        <button id="reset" class="btn">Reset</button>
        <button id="disclaimerBtn" class="btn">Disclaimer</button>
      </div>
    </div>

    <main>
      <div id="count" class="muted" style="margin-top:10px">0 results</div>
      <div class="grid" id="grid"></div>
    </main>

    <footer>Beta.</footer>
  </div>

  <div id="disclaimerModal" class="modal">
    <div class="modal-content disclaimer">
      <span class="modal-close">&times;</span>
      <h2>Investment Relevance Filters</h2>
      <p>When evaluating potential investors (VCs or corporate funds) for Drug4Sight, a series of characteristics of the funds' previous investments and available information about their investment strategy were analyzed to determine the level of fit with the project.</p>
      <p><span class="fit-label">Therapeutic Focus:</span> Funds with interest in ophthalmology, retina, or related rare/CNS diseases are prioritized.</p>
      <p><span class="fit-label">Molecule Modality:</span> Drug4Sight is a small-molecule drug. Investors backing small-molecule therapeutics are rated higher.</p>
      <p><span class="fit-label">Delivery Route:</span> Drug4Sight is topically delivered to the eye. Investors with ocular drug experience are preferred.</p>
      <p><span class="fit-label">Development Stage:</span> The project is at an early (preclinical) stage; funds investing in seed or Series A biotech are given higher fit.</p>
      <p><span class="fit-label">Geography:</span> Originating in Spain/Europe; European or global funds open to EU deals are prioritized.</p>
      <p><span class="fit-label">Portfolio and History:</span> Past investments in retina/ophthalmology, photopharmacology, or rare/neuro diseases increase relevance.</p>
      <p><em>Fit levels</em> range from <span class="fit-label fit-excellent">Excellent</span> (fully aligned) to <span class="fit-label fit-low">Low</span> (incompatible), based on therapeutic focus, stage, geography, and modality.</p>
      <p><span class="fit-label fit-excellent">Excellent fit:</span> Fully aligned in therapeutic focus, stage, geography, and modality; has prior retinal/ophthalmology investments.</p>
      <p><span class="fit-label fit-high">High fit:</span> Strong overlap in biotech focus (rare/CNS/ophthalmic); may lack one perfect match (e.g., not solely eye-focused).</p>
      <p><span class="fit-label fit-good">Good fit:</span> Invests in life sciences with relevant stage or modality but no direct retinal track record.</p>
      <p><span class="fit-label fit-moderate">Moderate fit:</span> Partial alignment (e.g., general biotech interest) but key gaps in focus, stage, or modality.</p>
      <p><span class="fit-label fit-low">Low fit:</span> Focus or stage is incompatible (e.g., later-stage, non-health sectors, or unrelated geography).</p>
      <p><span class="fit-label fit-neutral">Neutral:</span> No clear alignment or data; broad or undefined investment scope.</p>
    </div>
  </div>

  <!-- Detail modal: used to show the 'Drug4Sight' field for a selected card -->
  <div id="detailModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <span class="modal-close" id="detailClose">&times;</span>
      <h2 id="detailTitle">Details</h2>
      <div id="detailBody" style="white-space:pre-wrap;"></div>
    </div>
  </div>

  <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="display: none;">
    <defs>
      <filter id="goo">
        <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="10"></feGaussianBlur>
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 21 -7" result="goo"></feColorMatrix>
        <feBlend in2="goo" in="SourceGraphic" result="mix"></feBlend>
      </filter>
    </defs>
  </svg>

  <script>
    fetch('Table_version2.json')
      .then(response => response.json())
      .then(json => {
        const DATA = json["Venture Capital Firms"] || [];

        // filter containers (now multi-filter wrappers)
        const typeFilter = document.getElementById('typeFilter');
        const stageFilter = document.getElementById('stageFilter');
        const regionFilter = document.getElementById('regionFilter');
        const fitFilter = document.getElementById('fitFilter');
        const qInput = document.getElementById('q');
        const grid = document.getElementById('grid');
        const count = document.getElementById('count');
        const detailModal = document.getElementById('detailModal');
        const detailTitle = document.getElementById('detailTitle');
        const detailBody = document.getElementById('detailBody');
        const detailClose = document.getElementById('detailClose');

        function uniqueValues(arr, key) {
          const s = new Set();
          arr.forEach(r => {
            let v = r[key];
            if (v && typeof v === 'string') v.split(/[;,]\s*/).forEach(x => s.add(x.trim()));
            else if (v) s.add(String(v));
          });
          return [...s].filter(Boolean).sort((a,b)=>a.localeCompare(b));
        }

        // populate multi-filter checkbox lists
        function populateMultiFilter(container, key, items){
          const opts = container.querySelector('.options');
          opts.innerHTML = '';
          items.forEach(value=>{
            const id = `${container.id}-${value.replace(/\s+/g,'_').replace(/[^a-zA-Z0-9_\-]/g,'')}`;
            const label = document.createElement('label');
            label.htmlFor = id;
            const cb = document.createElement('input');
            cb.type = 'checkbox';
            cb.id = id;
            cb.value = value;
            cb.addEventListener('change', () => {
              updateSummary(container);
              render();
            });
            const span = document.createElement('span');
            span.textContent = value;
            label.appendChild(cb);
            label.appendChild(span);
            opts.appendChild(label);
          });
          updateSummary(container);
        }

        function updateSummary(container){
          const summary = container.querySelector('.summary');
          const checked = getSelectedValues(container);
          if(checked.length === 0){
            // default labels
            const def = {
              'typeFilter':'All types','stageFilter':'All stages','regionFilter':'All regions','fitFilter':'All fits'
            };
            summary.textContent = def[container.id] || `${checked.length} selected`;
          } else if(checked.length === 1){
            summary.textContent = checked[0];
          } else {
            summary.textContent = `${checked.length} selected`;
          }
        }

        function getSelectedValues(container){
          const boxes = [...container.querySelectorAll('.options input[type="checkbox"]')];
          return boxes.filter(ch=>ch.checked).map(ch=>ch.value);
        }

        function clearMultiFilter(container){
          container.querySelectorAll('.options input[type="checkbox"]').forEach(ch=>ch.checked=false);
          updateSummary(container);
        }

        function populateFilters(){
          populateMultiFilter(typeFilter, 'Type', uniqueValues(DATA,'Type'));
          populateMultiFilter(stageFilter, 'Investment Stage', uniqueValues(DATA,'Investment Stage'));
          populateMultiFilter(regionFilter, 'Where They Invest', uniqueValues(DATA,'Where They Invest'));
          populateMultiFilter(fitFilter, 'Drug4Sight Fit', uniqueValues(DATA,'Drug4Sight Fit'));
        }

        function normalize(s){ return (s||'').toString().toLowerCase(); }

        function mapFitToClass(fitVal){
          const val = normalize(fitVal);
          if(val.includes('excellent')) return 'fit-excellent';
          if(val.includes('high')) return 'fit-high';
          if(val.includes('good')) return 'fit-good';
          if(val.includes('moderate')) return 'fit-moderate';
          if(val.includes('potential')) return 'fit-potential';
          if(val.includes('low')) return 'fit-low';
          if(val.includes('neutral')) return 'fit-neutral';
          return 'fit-none';
        }

        // matchesRow adapted to accept arrays of selected filters
        function matchesRow(row,q,tFilters=[],sFilters=[],rFilters=[],fFilters=[]){
          const hay = [row['Name of VC / VB'], row['Where They Invest'], row['Investment Stage'], row['Location (HQ / Offices)'], row['Website'], row['Drug4Sight Fit']].map(normalize).join(' | ');
          if(q && !hay.includes(q)) return false;
          if(tFilters.length && !tFilters.some(tf => normalize(row['Type']) === normalize(tf))) return false;
          if(sFilters.length && !sFilters.some(sf => normalize(row['Investment Stage']).includes(normalize(sf)))) return false;
          if(rFilters.length && !rFilters.some(rf => (row['Where They Invest']||'').toLowerCase().includes(rf.toLowerCase()))) return false;
          if(fFilters.length && !fFilters.some(ff => normalize(row['Drug4Sight Fit']) === normalize(ff))) return false;
          return true;
        }

        function renderCard(row){
          const card=document.createElement('article');
          const fitClass=mapFitToClass(row['Drug4Sight Fit']);
          card.className=`card ${fitClass}`;

          const inner=document.createElement('div');
          inner.className='card-inner';

          const front=document.createElement('div');
          front.className='card-front';
          const img=document.createElement('img');
          const safeName=row['Name of VC / VB']?.replace(/\s+/g,'').toLowerCase();
          img.src=`${safeName}.png`;
          img.alt=`${row['Name of VC / VB']} logo`;
          img.onerror=function(){ if(!this._triedJpg){this._triedJpg=true;this.src=`${safeName}.jpg`;} else this.style.display='none';};
          front.appendChild(img);

          const h=document.createElement('h3');
          h.textContent=row['Name of VC / VB']||'—';
          front.appendChild(h);

          const meta=document.createElement('div');
          meta.className='meta';
          meta.innerHTML=`<div><strong>${row['Type']||''}</strong> • ${row['Investment Stage']||''}</div><div class='muted'>${row['Location (HQ / Offices)']||''}</div>`;
          front.appendChild(meta);

          const tags=document.createElement('div');
          tags.className='tags';
          const focus=row['Where They Invest'];
          if(focus) focus.toString().split(/[;,]\s*/).slice(0,6).forEach(t=>{const span=document.createElement('span');span.className='tag';span.textContent=t;tags.appendChild(span);});
          front.appendChild(tags);

          const back=document.createElement('div');
          back.className='card-back';
          // Make the fit indicator an interactive styled button that opens the detail modal
          const fitBtn = document.createElement('button');
          fitBtn.type = 'button';
          fitBtn.className = 'fit-indicator fit-btn';
          fitBtn.dataset.drug4sight = row['Drug4Sight'] || '';
          fitBtn.dataset.name = row['Name of VC / VB'] || '';
          // structured inner HTML to match the "learn-more" button style
          const fitText = (row['Drug4Sight Fit'] || 'No data').toString();
          fitBtn.innerHTML = `<span class="circle"><span class="icon arrow"></span></span><span class="button-text">${fitText}</span>`;
          back.appendChild(fitBtn);

          const notes=row['Observations / Notes']?.trim()||'No additional notes.';
          const notesDiv=document.createElement('div');
          notesDiv.className='notes';
          notesDiv.textContent=notes;
          back.appendChild(notesDiv);

          if(row['Website']){
            const a = document.createElement('a');
            a.className = 'blob-btn';
            a.href = row['Website'];
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            a.textContent = 'Visit website';
        
            const innerSpan = document.createElement('span');
            innerSpan.className = 'blob-btn__inner';
        
            const blobsSpan = document.createElement('span');
            blobsSpan.className = 'blob-btn__blobs';
        
            for (let i = 0; i < 4; i++) {
              const blobSpan = document.createElement('span');
              blobSpan.className = 'blob-btn__blob';
              blobsSpan.appendChild(blobSpan);
            }
        
            innerSpan.appendChild(blobsSpan);
            a.appendChild(innerSpan);
            back.appendChild(a);
          }

          inner.appendChild(front);
          inner.appendChild(back);
          card.appendChild(inner);
          return card;
        }

        function render(){
          const q=normalize(qInput.value);
          const t=getSelectedValues(typeFilter);
          const s=getSelectedValues(stageFilter);
          const r=getSelectedValues(regionFilter);
          const f=getSelectedValues(fitFilter);
          const rows=DATA.filter(row=>matchesRow(row,q,t,s,r,f));
          grid.innerHTML=''; rows.forEach(r=>grid.appendChild(renderCard(r)));
          count.textContent=`${rows.length} result${rows.length!==1?'s':''}`;
        }

        populateFilters(); render();
        document.getElementById('clear').onclick=()=>{qInput.value='';render();qInput.focus();}
        document.getElementById('reset').onclick=()=>{ clearMultiFilter(typeFilter); clearMultiFilter(stageFilter); clearMultiFilter(regionFilter); clearMultiFilter(fitFilter); qInput.value=''; render(); }
        [qInput].forEach(el=>el.addEventListener('input',render));

        // Toggle dropdowns and close on outside click / Escape
        document.querySelectorAll('.multi-filter').forEach(container=>{
          const btn = container.querySelector('.summary');
          btn.addEventListener('click', (e)=>{
            e.stopPropagation();
            // close other filters
            document.querySelectorAll('.multi-filter').forEach(c=>{ if(c!==container) c.classList.remove('open'); });
            container.classList.toggle('open');
          });
        });

        window.addEventListener('click', (ev)=>{
          // close all filter dropdowns if click outside
          if(!ev.target.closest('.multi-filter')){
            document.querySelectorAll('.multi-filter').forEach(c=>c.classList.remove('open'));
          }
        });
        document.addEventListener('keydown', (ev)=>{
          if(ev.key === 'Escape') document.querySelectorAll('.multi-filter').forEach(c=>c.classList.remove('open'));
        });

        // --- Consolidated Modal Functionality ---
        const modalElement = document.getElementById('disclaimerModal');
        const disclaimerButton = document.getElementById('disclaimerBtn');
        const closeElement = document.querySelector('.modal-close');

        function openModal() {
          modalElement.style.display = 'block';
          document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeModal() {
          modalElement.style.display = 'none';
          document.body.style.overflow = 'auto'; // Re-enable scrolling
        }

        // Event Listeners
        disclaimerButton.addEventListener('click', (e) => {
          e.preventDefault();
          openModal();
        });

        closeElement.addEventListener('click', closeModal);

        // Close modal if user clicks outside of the content or presses Escape key
        window.addEventListener('click', (event) => {
          if (event.target === modalElement) {
            closeModal();
          }
          if (event.target === detailModal) {
            closeDetailModal();
          }
        });

        // --- Detail modal functions for the per-card 'Drug4Sight' text ---
        function openDetailModal(title, text){
          detailTitle.textContent = title || 'Details';
          detailBody.textContent = text || 'No additional details available.';
          detailModal.style.display = 'block';
          detailModal.setAttribute('aria-hidden','false');
          document.body.style.overflow = 'hidden';
        }

        function closeDetailModal(){
          detailModal.style.display = 'none';
          detailModal.setAttribute('aria-hidden','true');
          document.body.style.overflow = 'auto';
        }

        // Close detail modal via its close button
        detailClose.addEventListener('click', closeDetailModal);

        // Delegate clicks on fit buttons (they are created dynamically)
        grid.addEventListener('click', (ev) => {
          const btn = ev.target.closest('.fit-btn');
          if (!btn) return;
          const txt = btn.dataset.drug4sight || '';
          const name = btn.dataset.name || btn.textContent || 'Details';
          openDetailModal(name, txt);
        });

        // Global keyboard handling: Escape closes modals; Enter on card opens website (existing behaviour)
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape') {
            if (modalElement.style.display === 'block') closeModal();
            if (detailModal.style.display === 'block') closeDetailModal();
          }
          if (event.key==='Enter' && event.target && event.target.matches('.card')){
            const a = event.target.querySelector('a.blob-btn'); 
            if(a) window.open(a.href,'_blank');
          }
        });
      });
  </script>
</body>
</html>